{extend name="./oscshop/admin/view/public/base.html" /}
{block name="content"}
<div class="page-header">
	<h1>	
		{$breadcrumb1}
		<small>
			<i class="ace-icon fa fa-angle-double-right"></i>
			{$breadcrumb2}
		</small>
	</h1>
</div>

<div class="page-header">	
	<a href="{:url('MemberBackend/add')}" class="btn btn-primary">新增</a>
</div>		
<table class="table table-striped table-bordered table-hover search-form">
	<thead>
		
		<th><input name="condition" type="text" placeholder="请输入微信openId/昵称" value="{:input('param.condition')}" /></th>		
		
		<th>
			<a class="btn btn-primary" href="javascript:;" id="search" url="{:url('MemberBackend/index')}">查询</a>
		</th>
	</thead>
</table>	
	
<div class="row">
	<div class="col-xs-12">	
		<div class="table-responsive">
			<table class="table table-striped table-bordered table-hover">
				<thead>
					<tr>											
						<th>ID</th>
						<th>微信openId</th> 
						<th>昵称</th> 
						<th>登录次数</th> 						
						<th>创建时间</th>							
						<th>最后登录</th>	
						<th>主账户金额（元）</th>		
						<th>辅账户金额（元）</th>		
						<th>状态</th> 	
						<th>操作</th>	
					</tr>
				</thead>
				<tbody>
					{volist name="list" id="v" empty="$empty"}
					<tr>						
						<td>{$v.uid}</td>
						<td>{$v.openId}</td>
						<td>{$v.username}</td>
						<td>{$v.loginnum}</td>
						<td>{if condition="$v['regdate'] neq 0"}{$v.regdate|date="Y-m-d",###}{else/}无{/if}</td>
						<td>{if condition="$v['lastdate'] neq 0"}{$v.lastdate|date="Y-m-d",###}{else/}无{/if}</td>
						<td><input name="mainAccount" type="text" size="8" class="account" uid='{$v.uid}' value="{$v.mainAccount}" /></td>
						<td><input name="secondAccount" type="text" size="8" class="account" uid='{$v.uid}' value="{$v.secondAccount}" /></td>
						<td>							
							{switch name="v.checked"}
								{case value="1"}<a href='{:url("MemberBackend/set_status",array("uid"=>$v["uid"],"checked"=>0))}'><span class="btn btn-xs btn-success"><i class="fa fa-check bigger-120"></i></span></a>{/case}
								{case value="0"}<a href='{:url("MemberBackend/set_status",array("uid"=>$v["uid"],"checked"=>1))}'><span class="btn btn-xs btn-danger"><i class="fa fa-remove bigger-120"></i></span></a>{/case}
							{/switch}
						</td>
						<td>
							<a class="btn btn-xs btn-info" href='{:url("MemberBackend/edit",array("id"=>$v["uid"]))}'>
								<i class="fa fa-edit bigger-120"></i>
							</a> 
						</td>
					</tr>
					{/volist}	
					
					<tr>
						<td colspan="20" class="page">{$list->render()}</td>
					</tr>
				</tbody>
				
			</table>
		</div>
	</div>
</div>
{/block}
{block name="javascript"}
<script>	
$(function(){
   $("#search").click(function () {
        var url = $(this).attr('url');
        var query = $('.search-form').find('input,select').serialize();
        query = query.replace(/(&|^)(\w*?\d*?\-*?_*?)*?=?((?=&)|(?=$))/g, '');
        query = query.replace(/^&/g, '');
        if (url.indexOf('?') > 0) {
            url += '&' + query;
        } else {
            url += '?' + query;
        }
        window.location.href = url;
    });	
    //修改用户账户金额
    $('.account').blur(function(){
		$.post(
			"{:url('MemberBackend/updateAccount')}",
			{accountMoney:$(this).val(),accountName:$(this).attr('name'),uid:$(this).attr('uid')},
			function(data){
				if(data){
					window.location.reload();
				}
			}
		);
	});
});
</script>
{/block}